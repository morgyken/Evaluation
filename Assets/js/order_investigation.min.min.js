$(function(){function t(){var t='<td><select name="item'+o+'" id="item_'+o+'" class="select2-single" style="width: 100%"></select></td>\n<td><input type="text" id="price_'+o+'" name="price'+o+'" readonly=\'\'/></td>\n<td><input value="1" type="text" id="quantity_'+o+'" name="quantity'+o+"\" placeholder=\"No. Performed\"/></td>\n<td><input value='0' type='text' id='discount_"+o+"' name='discount"+o+"' placeholder='Discount'/></td>\n<td><input type='text' id='amount_"+o+"' name='amount"+o+'\' placeholder=\'Amount\'/></td>\n<td><button class="btn btn-xs btn-danger remove"><i class="fa fa-trash-o"></i></button></td>';$("#addr"+o).html(t),$("#evaluation_order tbody").append('<tr id="addr'+(o+1)+'"></tr>'),e(o),o++}function e(e){$("#addr"+e+" select").select2({theme:"classic",placeholder:"Please select a procedure",formatNoMatches:function(){return"No matching procedure found"},formatInputTooShort:function(t,e){return"Please enter "+(e-t.length)+" more characters"},formatInputTooLong:function(t,e){return"Please enter "+(t.length-e)+" less characters"},formatSelectionTooBig:function(t){return"You can only select "+t+" items"},formatLoadMore:function(t){return"Loading more results..."},formatSearching:function(){return"Searching..."},minimumInputLength:2,allowClear:!0,ajax:{url:PROCEDURE_URL,dataType:"json",cache:!0,data:function(t,e){return{term:t}},results:function(t,e){return{results:t}}}}),$("#addr"+e+" select").on("select2:select",function(n){var a=$(this).find("option:selected").data().data.price,o=$("#discount_"+e).val(),i=r(a,$("#quantity_"+e).val(),o);$("input[name=price"+e+"]").val(a),$("input[name=amount"+e+"]").val(i),t()}),1==$("#no_discount").val()&&($("#discount_"+e).attr("readonly",!0),$("#discount_"+e).css("background-color","#DEDEDE")),$(".remove").click(function(t){t.preventDefault(),$(this).closest("tr").remove()}),$("#discount_"+e).keyup(function(t){t.preventDefault(),n(e)}),$("#quantity_"+e).keyup(function(t){t.preventDefault(),n(e)}),$("#amount_"+e).keyup(function(t){t.preventDefault(),a(e)})}function n(t){var e=$("#price_"+t).val(),n=$("#discount_"+t).val(),a=r(e,$("#quantity_"+t).val(),n);$("input[name=amount"+t+"]").val(a.toFixed(2))}function a(t){var e=$("#price_"+t).val()*$("#quantity_"+t).val(),n=100*(e-$("#amount_"+t).val())/e;$("#discount_"+t).val(n.toFixed(2))}function r(t,e,n){try{var a=t*e;return a-a*(n/100)}catch(e){return t}}$("#evaluation_order .check").click(function(){var t=$(this).parent().parent().find("input"),e=$(this).parent().parent().find("textarea");$(this).is(":checked")?(t.prop("disabled",!1),e.prop("disabled",!1),$(e).parent().show()):(t.prop("disabled",!0),e.prop("disabled",!0),$(e).parent().hide()),$(this).prop("disabled",!1)});var o=0;e(o),o++});